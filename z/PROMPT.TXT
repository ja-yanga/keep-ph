You are given an existing SQL query currently used directly inside an API route or component.

Your task is to refactor it into an RPC-based implementation that strictly follows this flow:

Component/Page → fetchFromAPI → API Endpoint → RPC Function → Database

Rules:

The RPC must be created in a new file.

Do not keep raw SQL inside components, pages, or API handlers.

The API endpoint must only validate input, call the RPC, and return the result.

fetchFromAPI must be the only way the UI talks to the backend.

Follow our SQL naming conventions:

Use snake_case for identifiers.

SQL keywords must be UPPERCASE.

Input variables use prefix input_.

Local variables use prefix var_.

Return variable must be named return_data.

Always use the table name as the alias.

The expected output of the RPC must be exactly the same as the original SQL output. No added fields, no removed fields, no behavior changes. The refactor must be logically equivalent so existing features do not break.

Deliverables:

The new RPC file with the converted SQL.

The updated API endpoint that calls the RPC.

The updated fetchFromAPI function if needed.

The updated Component/Page code that consumes fetchFromAPI.

ALL NEW ADDED FUNCTION IN SERVER ACTIONS WILL BE IN THE BOTTOM OR IN THE LAST LINE, SO THAT IT CAN MANAGE EASILY.